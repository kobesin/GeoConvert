var GeoConvert={};GeoConvert.emptyGeojson=function(){var e={};return e.type="FeatureCollection",e.features=[],e},GeoConvert.decode={},GeoConvert.decode.utf8=new TextDecoder("utf-8"),GeoConvert.decode.big5=new TextDecoder("big5"),function(e,t,r){function n(e){var t={};if(e.attributes)for(var r=0,a=e.attributes.length;a>r;r++){var o=e.attributes[r],i=o.nodeValue,s=!isNaN(parseFloat(i))&&isFinite(i)?parseFloat(i):i;t["@"+o.nodeName]=s}if(e.children.length>0)for(var c={},r=0,a=e.children.length;a>r;r++){var l=e.children[r];"_"!==l.tagName[0]?t[l.tagName]?(c[l.tagName]||(t[l.tagName]=[t[l.tagName]],c[l.tagName]=!0),t[l.tagName].push(n(l))):(t[l.tagName]=n(l),c[l.tagName]=!1):c[l.tagName]?t.push(n(l)):(t=[n(l)],c[l.tagName]=!0)}else{var p=e.textContent,s=!isNaN(parseFloat(p))&&isFinite(p)?parseFloat(p):p;Object.keys(t).length>0?t["#"]=s:t=s}return t}function a(e,t,r){var n=r.createElement(e);if(t.forEach)t.forEach(function(e){var t=a("_array",e,r);n.appendChild(t)});else if("object"==typeof t)for(var o in t)if("@"===o[0]){var e=o.replace("@","");n.setAttribute(e,t[o])}else if("#"===o)n.textContent=t[o];else if("object"!=typeof t[o]){var i=r.createElement(o);i.textContent=t[o],n.appendChild(i)}else if(t[o].forEach&&t[o].sameName)t[o].forEach(function(e){var t=a(o,e,r);n.appendChild(t)});else{var i=a(o,t[o],r);n.appendChild(i)}else n.textContent=t;return n}GeoConvert.xml2Json=function(t,r){var a;a=e.DOMParser?function(t){return(new e.DOMParser).parseFromString(t,"text/xml")}:"undefined"!=typeof e.ActiveXObject&&new e.ActiveXObject("Microsoft.XMLDOM")?function(t){var r=new e.ActiveXObject("Microsoft.XMLDOM");return r.async="false",r.loadXML(t),r}:function(){return null};var o;if("string"==typeof t)o=a(t);else{if("object"!=typeof t||!t.xmlVersion)throw new Error("Unsupported input type");o=t}var i=n(o);if(r){var s=JSON.stringify(i);return s}return i},GeoConvert.json2Xml=function(e,r,n){var o;o="string"==typeof e?JSON.parse(e):e;var i,s=r.trim()?r:"root",c=t.implementation.createDocument(null,"create");if(i=a(s,o,c),n){var l="<?xml version='1.0' encoding='UTF-8'?>"+(new XMLSerializer).serializeToString(i);return l}return i}}(window,document),function(e,t,r){function n(e,t,r,i){switch(e){case"kml":case"Document":case"Folder":if(t.forEach)t.forEach(function(t){n(e,t,r,i)});else{var s=Object.keys(t),c=s.indexOf("Style");l>-1&&(s.splice(l,1),n("StyleMap",t.StyleMap,r,i));var l=s.indexOf("StyleMap");c>-1&&(s.splice(c,1),n("Style",t.Style,r,i)),s.forEach(function(e){n(e,t[e],r,i)})}break;case"Placemark":t.forEach?t.forEach(function(e){r.features.push(o(e,i))}):r.features.push(o(t,i));break;case"Style":case"StyleMap":t.forEach?t.forEach(function(e){e["@id"]&&(i[e["@id"]]=e)}):t["@id"]&&(i[t["@id"]]=t);break;case"GroundOverlay":t.forEach?t.forEach(function(e){r.features.push(a(e))}):r.features.push(a(t))}}function a(e){var t={};if(t.type="Feature",t.properties={},t.geometry=null,e.name&&(t.properties.name=e.name),e.description&&(t.properties.description=e.description),e.Icon&&e.Icon.href&&(t.properties.iconUrl=e.Icon.href),e.visibility&&(t.properties.opacity=parseFloat(e.visibility)),e.LatLonBox){latLonBox=e.LatLonBox;var r=[parseFloat(latLonBox.south),parseFloat(latLonBox.west)],n=[parseFloat(latLonBox.north),parseFloat(latLonBox.east)],a=[r,n];t.properties.latLngBounds=a}return t}function o(e,t){var r={};if(r.type="Feature",r.properties={},r.style={},e.name&&(r.properties.name=e.name),e.description&&(r.properties.description=e.description),e["gx:MultiTrack"]){var n={},a=[],o=e["gx:MultiTrack"],s=o["gx:Track"],c=s["gx:coord"];c&&c.forEach(function(e){if(""!==e.trim()){var t=e.split(" ");a.push([parseFloat(t[0]),parseFloat(t[1])])}}),s.when&&(r.properties.when=s.when),s.ExtendedData&&s.ExtendedData.SchemaData&&s.ExtendedData.SchemaData["gx:SimpleArrayData"]&&s.ExtendedData.SchemaData["gx:SimpleArrayData"].forEach(function(e){r.properties[e["@name"]]=e["gx:value"]}),n.type="LineString",n.coordinates=a,r.geometry=n}else r.geometry=i(e);var p=e.Style||{};if(e.styleUrl){var u=e.styleUrl.replace("#","");if(t[u]){var f,y;t[u].Pair?(t[u].Pair.forEach(function(e){e.key&&"normal"===e.key&&(y=e.styleUrl.replace("#",""))}),f=t[y]):f=t[u];var v=Object.keys(Object.assign({},p,f));v.forEach(function(e){var t=typeof p[e];"object"===t?p[e]=Object.assign({},p[e],f[e]):"undefined"===t&&(p[e]=f[e])})}}for(var h in p)switch(h){case"IconStyle":var m=p.IconStyle.Icon.href,g=p.IconStyle.scale,d=p.IconStyle.color;if(m&&(r.style.iconUrl=m),g&&(r.style.scale=parseFloat(g)),d&&(d=l(d),r.style.color=d.hex,r.style.opacity=d.opacity),p.IconStyle.hotSpot){var b=parseFloat(p.IconStyle.hotSpot["@x"]),k=parseFloat(p.IconStyle.hotSpot["@y"]);r.style.iconAnchor=[b,k]}break;case"LineStyle":var d=l(p.LineStyle.color),S=parseFloat(p.LineStyle.width);d&&(r.style.color=d.hex,r.style.opacity=d.opacity),S&&(r.style.weight=S);break;case"PolyStyle":var d=l(p.PolyStyle.color),x=parseInt(x),E=parseInt(p.PolyStyle.outline);d&&(r.style.fillColor=d.hex,r.style.fillOpacity=d.opacity),x&&(r.style.fill=x),E&&(r.style.stroke=E)}return r}function i(e){var t={};if(e.Point)if(e.Point.forEach){var r=[];e.Point.forEach(function(e){var t=[],n=e.coordinates.replace(/\t|\n/gi,"");if(""!==n.trim()){var a=n.split(",");t=[parseFloat(a[0]),parseFloat(a[1])]}r.push(t)}),t.type="MultiPoint",t.coordinates=r}else{var r=[],n=e.Point.coordinates.replace(/\t|\n/gi,"");if(""!==n.trim()){var a=n.split(",");r=[parseFloat(a[0]),parseFloat(a[1])]}t.type="Point",t.coordinates=r}else if(e.LineString)if(e.LineString.forEach){var r=[];e.LineString.forEach(function(e){var t=[],n=e.coordinates.replace(/\t|\n/gi,"");n.split(" ").forEach(function(e){if(""!==e.trim()){var r=e.split(",");t.push([parseFloat(r[0]),parseFloat(r[1])])}}),r.push(t)}),t.type="MultiLineString",t.coordinates=r}else{var r=[],o=e.LineString.coordinates.replace(/\t|\n/gi,"");o.split(" ").forEach(function(e){if(""!==e.trim()){var t=e.split(",");r.push([parseFloat(t[0]),parseFloat(t[1])])}}),t.type="LineString",t.coordinates=r}else if(e.Polygon)if(e.Polygon.forEach){var r=[];e.Polygon.forEach(function(e){var t=c(e);r.push(t)}),t.type="MultiPolygon",t.coordinates=r}else{var r=c(e.Polygon);t.type="Polygon",t.coordinates=r}else if(e.MultiGeometry){var s=e.MultiGeometry;if(Object.keys(s).length>1){var l=[];for(var p in s)if(s[p].forEach)s[p].forEach(function(e){var t={};t[p]=e,l.push(i(t))});else{var u={};u[p]=s[p],l.push(i(u))}t.type="GeometryCollection",t.geometries=l}else t=i(s)}return t}function s(e){var t=[],r=e.LinearRing.coordinates.replace(/\t|\n/gi,"");return r.split(" ").forEach(function(e){if(""!==e.trim()){var r=e.split(",");t.push([parseFloat(r[0]),parseFloat(r[1])])}}),t}function c(e){var t=[];return["outerBoundaryIs","innerBoundaryIs"].forEach(function(r){var n=e[r];if(n){var a;n.forEach?n.forEach(function(e){a=s(e),t.push(a)}):(a=s(n),t.push(a))}}),t}function l(e){var t={};return"string"==typeof e&&8===e.length?(t.hex="#"+e.slice(6,8)+e.slice(4,6)+e.slice(2,4),t.opacity=Math.round(parseInt(e.slice(0,2),16)/255*100)/100):(t.hex="#000",t.opacity=1),t}function p(){var e={};return e["@xmlns"]="http://www.opengis.net/kml/2.2",e["@xmlns:gx"]="http://www.google.com/kml/ext/2.2",e["@xmlns:kml"]="http://www.opengis.net/kml/2.2",e["@xmlns:atom"]="http://www.w3.org/2005/Atom",e.Document={},e}function u(e,t,r){switch(e.type){case"Point":case"LineString":case"Polygon":var n=e.type;if(t[n]){var a=y(n,e.coordinates);t[n].push||(t[n]=[t[n]],t[n].sameName=!0),t[n].push(a)}else t[n]=y(n,e.coordinates);break;case"MultiPoint":case"MultiLineString":case"MultiPolygon":var n=e.type.replace("Multi","");t.MultiGeometry={},e.coordinates.forEach(function(e){u({type:n,coordinates:e},t.MultiGeometry)});break;case"GeometryCollection":t.MultiGeometry={},e.geometries.forEach(function(e){u(e,t.MultiGeometry)});break;case"Feature":var a={};u(e.geometry,a),e.properties.name&&(a.name=e.properties.name),e.properties.description&&(a.description=e.properties.description);var o=f(e,r);a.styleUrl=o,t.push(a);break;case"FeatureCollection":e.features.forEach(function(e){u(e,t,r)})}}function f(e,t){var r=Object.assign({},e.style),n=0;return t.forEach(function(e,t){var a=!1;for(var o in r)r[o]!==e[o]&&(a=!0);a||(n=t+1)}),0===n&&(t.push(r),n=t.length),"custom"+n}function y(e,t){var r={};switch(e){case"Point":r={},r.coordinates=t.join();break;case"LineString":r={},r.tessellate=1,r.coordinates=t.join(" ");break;case"Polygon":r={},r.tessellate=1,r.outerBoundaryIs={},r.outerBoundaryIs.LinearRing={},r.outerBoundaryIs.LinearRing.coordinates=t[0].join(" "),t.shift(),t.forEach(function(e){r.innerBoundaryIs={},r.innerBoundaryIs.LinearRing={},r.innerBoundaryIs.LinearRing.coordinates=e.join(" ")})}return r}function v(e){var t={};t.stroke="outline",t.fill="fill";var r=e.map(function(e,t){var r={};r["@id"]="custom"+(t+1);for(var n in e){switch(n){case"iconUrl":case"iconAnchor":case"scale":r.IconStyle||(r.IconStyle={});break;case"color":case"weight":r.LineStyle||(r.LineStyle={});break;case"stroke":case"fill":case"fillColor":r.PolyStyle||(r.PolyStyle={})}switch(n){case"iconUrl":r.IconStyle.Icon={},r.IconStyle.Icon.href=e.iconUrl;break;case"iconAnchor":r.IconStyle.hotSpot={},r.IconStyle.hotSpot["@x"]=e.iconAnchor[0],r.IconStyle.hotSpot["@y"]=e.iconAnchor[1],r.IconStyle.hotSpot["@xunits"]="pixels",r.IconStyle.hotSpot["@yunits"]="pixels";break;case"scale":r.IconStyle.scale=e.scale;break;case"color":r.LineStyle.color=h(e.color,e.opacity);break;case"weight":r.LineStyle.width=e.weight;break;case"stroke":r.PolyStyle.outline=e.stroke;case"fill":r.PolyStyle.fill=e.fill;break;case"fillColor":r.PolyStyle.color=h(e.fillColor,e.fillOpacity)}}return r});return r.sameName=!0,r}function h(e,t){e=e.replace("#",""),t=t?t:1;var r=parseInt(255*t).toString(16),n=r+e.slice(4,6)+e.slice(2,4)+e.slice(0,2);return n}GeoConvert.kml2Geojson=function(e,t){var r;if("string"==typeof e)if(-1!==e.indexOf("kml:")){var a=e.replace(/\kml:/gi,"");r=GeoConvert.xml2Json(a)}else r=GeoConvert.xml2Json(e);else{if("object"!=typeof e||!e.xmlVersion)throw new Error("Unsupported input type");r=GeoConvert.xml2Json(e)}var o=GeoConvert.emptyGeojson(),i={};if(n("kml",r.kml,o,i),t){var s=JSON.stringify(o);return s}return o},GeoConvert.geojson2Kml=function(e,t){var r;r="string"==typeof e?JSON.parse(e):e;var n=p(),a=[],o=[];a.sameName=!0,"Feature"!==r.type&&"FeatureCollection"!==r.type&&(r={type:"Feature",geometry:r,properties:{}}),u(r,a,o),n.Document.Style=v(o),n.Document.Placemark=a;var i=GeoConvert.json2Xml(n,"kml");if(t){var s="<?xml version='1.0' encoding='UTF-8'?>"+(new XMLSerializer).serializeToString(i);return s}return i}}(window,document),function(e,t,r){GeoConvert.kmz2Geojsons=function(e,t){function r(){if(n--,0===n){var e=[];o.forEach(function(t){var r=GeoConvert.kml2Geojson(t);r.features.forEach(function(e){e.style&&e.style.iconUrl&&i[e.style.iconUrl]&&(e.style.iconUrl=i[e.style.iconUrl])}),e.push(r)}),t&&t(e)}}if(JSZip){var n=0,a=new JSZip,o=[],i={};a.loadAsync(e).then(function(e){for(var t in a.files){n++;var s=a.file(t).name.split(".").pop();"kml"===s?e.file(t).async("string").then(function(e){o.push(e),r()},function(e){n--}):"png"===s||"jpg"===s?e.file(t).async("base64").then(function(e){var n="data:image/"+s+";base64,";i[t]=n+e,r()},function(e){n--}):n--}})}}}(window,document),function(e,t,r){function n(e,t,r){if("gpx"===e)for(var s in t)n(s,t[s],r);else{var c;switch(e){case"wpt":c=a;break;case"trk":c=o;break;case"rte":c=i}c&&(t.forEach?t.forEach(function(e){r.features.push(c(e))}):r.features.push(c(t)))}}function a(e){var t={};t.type="Feature",t.properties={},t.properties.name=e.name,t.properties.cmt=e.cmt,t.properties.desc=e.desc,t.properties.time=e.time,t.geometry={},t.geometry.type="Point";var r=[e["@lon"],e["@lat"]];return t.geometry.coordinates=r,t}function o(e){var t={};t.type="Feature",t.properties={},t.properties.name=e.name,t.geometry={};var r;if(e.trkseg&&e.trkseg.trkpt){var n=e.trkseg.trkpt;n.forEach?(t.geometry.type="LineString",r=[],n.forEach(function(e){var t=[e["@lon"],e["@lat"]];r.push(t)})):(t.geometry.type="Point",r=[n["@lon"],n["@lat"]])}return t.geometry.coordinates=r,t}function i(e){var t={};t.type="Feature",t.properties={},t.properties.name=e.name,t.geometry={};var r;if(e.rtept){var n=e.rtept;n.forEach?(t.geometry.type="LineString",r=[],n.forEach(function(e){var t=[e["@lon"],e["@lat"]];r.push(t)})):(t.geometry.type="Point",r=[n["@lon"],n["@lat"]])}return t.geometry.coordinates=r,t}function s(){var e={};return e["@xmlns"]="http://www.topografix.com/GPX/1/1",e["@version"]="1.1",e["@creator"]="GeoConvert",e.metadata={},e.metadata.name="Geojson to GPX",e}function c(e,t,r,n){switch(e.type){case"Point":var a=l(e.coordinates);a.name=n.name?n.name:"",t.push(a);break;case"LineString":var o=p(e.coordinates);o.name=n.name?n.name:"",r.push(o);break;case"MultiPoint":case"MultiLineString":var i=e.type.replace("Multi","");e.coordinates.forEach(function(e){c({type:i,coordinates:e},t,r,n)});break;case"GeometryCollection":e.geometries.forEach(function(e){c(e,t,r,n)});break;case"Feature":c(e.geometry,t,r,e.properties);break;case"FeatureCollection":e.features.forEach(function(e){c(e,t,r)})}}function l(e){var t={};return t["@lon"]=e[0],t["@lat"]=e[1],t}function p(e){var t={};return t.rtept=[],t.rtept.sameName=!0,e.forEach(function(e){var r={};r["@lon"]=e[0],r["@lat"]=e[1],t.rtept.push(r)}),t}GeoConvert.gpx2Geojson=function(e,t){var r;if("string"==typeof e)r=GeoConvert.xml2Json(e);else{if("object"!=typeof e||!e.xmlVersion)throw new Error("Unsupported input type");r=GeoConvert.xml2Json(e)}var a=GeoConvert.emptyGeojson();if(n("gpx",r.gpx,a),t){var o=JSON.stringify(a);return o}return a},GeoConvert.geojson2Gpx=function(e,t){var r;r="string"==typeof e?JSON.parse(e):e;var n=s(),a=[],o=[];a.sameName=!0,o.sameName=!0,"Feature"!==r.type&&"FeatureCollection"!==r.type&&(r={type:"Feature",geometry:r,properties:{}}),c(r,a,o),n.wpt=a,n.rte=o;var i=GeoConvert.json2Xml(n,"gpx");if(t){var l="<?xml version='1.0' encoding='UTF-8'?>"+(new XMLSerializer).serializeToString(i);return l}return i}}(window,document),function(e,t,r){function n(e){if(e.shp&&e.dbf){var t=GeoConvert.emptyGeojson(),r=e.prj,n=e.encoding;return o(e.shp,t,r),f(e.dbf,t,n),t}throw new Error("need complete shapefile")}function a(e,t){this.fromProjection=e,this.toProjection=t}function o(e,t,r){var n=new DataView(e),o=n.byteLength,c=(n.getInt32(24),n.getInt32(32,!0),n.getFloat64(36,!0),n.getFloat64(44,!0),n.getFloat64(52,!0),n.getFloat64(60,!0),r&&!/GCS_WGS_1984|WGS84/g.test(r)?new a(r,proj4.WGS84):c);t.bbox=s(n,36,c);for(var l=100;o>l;){var p=i(n,l,c);t.features.push(p.feature),l=p.byteOffset}}function i(e,t,r){var n={},a={};a.type="Feature";var o=(e.getInt32(t),e.getInt32(t+4)),i=e.getInt32(t+8,!0);t+=12;var s;switch(i){case 0:break;case 1:case 11:case 21:s=c;break;case 3:case 13:case 23:s=p;break;case 5:case 15:case 25:s=u;break;case 8:case 18:s=l;break;case 28:break;case 31:}if(s){var f={},y=s(e,t,r);f.type=y.type,f.coordinates=y.coordinates,y.box&&(a.bbox=y.box),a.geometry=f}return n.feature=a,n.byteOffset=t+2*o-4,n}function s(e,t,r){var n,a=e.getFloat64(t,!0),o=e.getFloat64(t+8,!0),i=e.getFloat64(t+16,!0),s=e.getFloat64(t+24,!0);return n=r?r.trans([a,o]).concat(r.trans([i,s])):[a,o,i,s]}function c(e,t,r){var n={},a=e.getFloat64(t,!0),o=e.getFloat64(t+8,!0);return t+=16,n.type="Point",n.coordinates=r?r.trans([a,o]):[a,o],n}function l(e,t,r){var n={},a=s(e,t,r),o=e.getInt32(t+32,!0),i=[];t+=36;for(var c=0;o>c;c++){var l=e.getFloat64(t,!0),p=e.getFloat64(t+8,!0),u=r?r.trans([l,p]):[l,p];i.push(u),t+=16}return n.type="MultiPoint",n.box=a,n.coordinates=i,n}function p(e,t,r){for(var n={},a=s(e,t,r),o=e.getInt32(t+32,!0),i=e.getInt32(t+36,!0),c=[],l=[],p=[],u=0;o>u;u++){var f=e.getInt32(t+40+4*u,!0)-1;c.push(f)}c.push(i-1),t=t+40+4*o;for(var u=0;i>u;u++){var y=e.getFloat64(t,!0),v=e.getFloat64(t+8,!0),h=r?r.trans([y,v]):[y,v];l.push(h),t+=16,-1!==c.indexOf(u)&&(p.push(l),l=[])}return n.box=a,n.numPoints=i,1===o?(n.type="LineString",n.coordinates=p[0]):(n.type="MultiLineString",n.coordinates=p),n}function u(e,t,r){for(var n={},a=s(e,t,r),o=e.getInt32(t+32,!0),i=e.getInt32(t+36,!0),c=[],l=[],p=[],u=[],f=null,y=null,v=0,h=0;o>h;h++){var m=e.getInt32(t+40+4*h,!0)-1;c.push(m)}c.push(i-1),t=t+40+4*o;for(var h=0;i>h;h++){var g=e.getFloat64(t,!0),d=e.getFloat64(t+8,!0),b=r?r.trans([g,d]):[g,d];l.push(b),t+=16,f&&y||([f,y]=[g,d]),v+=(g-f)*(d+y),[f,y]=[g,d],-1!==c.indexOf(h)&&(p.push(l),v>=0?u.push(p):u[u.length-1]=u[u.length-1].concat(p),l=[],p=[],v=0,[f,y]=[null,null])}return n.box=a,n.numPoints=i,1===o?(n.type="Polygon",n.coordinates=u[0]):(n.type="MultiPolygon",n.coordinates=u),n}function f(e,t,r){var n,a=new DataView(e),o=(a.byteLength,a.getInt8(0)),i=a.getInt32(4,!0),s=a.getInt16(8,!0),c=a.getInt16(10,!0),l=r||a.getInt8(29);switch(l){case 79:case"0x4F":n=GeoConvert.decode.big5;break;default:n=GeoConvert.decode.utf8}if(3!==o)throw new Error("File has unknown/unsupported dBase version:"+o);for(var p=32,u=[];13!==a.getUint8(p);){var f={};f.name=n.decode(e.slice(p,p+10)).replace(/\u0000/g,""),f.type=y[n.decode(e.slice(p+11,p+12))],f.fieldLength=a.getUint8(p+16),f.decimals=a.getUint8(p+17),u.push(f),p+=32}for(var v=u.length,h=0;i>h;h++){var m={};p=s+h*c,p+=1;for(var g=0;v>g;g++){var d=u[g],b=n.decode(e.slice(p,p+d.fieldLength)).trim();m[d.name]=b,p+=d.fieldLength}t.features[h].properties=m}}var y={N:"Number",C:"Character",L:"Logical",D:"Date",M:"Memo",F:"Floating point",B:"Binary",G:"General",P:"Picture",Y:"Currency",T:"DateTime",I:"Integer",V:"VariField",X:"Variant","@":"Timestamp",O:"Double","+":"Autoincrement"};GeoConvert.shapefile2Geojson=function(e,t){var r=n(e);if(t){var a=JSON.stringify(r);return a}return r},a.prototype.trans=function(e){return proj4(this.fromProjection,this.toProjection,e)}}(window,document),function(e,t,r){function n(e,t){this.fromProjection=e,this.toProjection=t}function a(e){if(e.dxf!==r){var t=GeoConvert.emptyGeojson(),a=e.prj,i=a&&!/GCS_WGS_1984|WGS84/g.test(a)?new n(a,proj4.WGS84):i,s=o(e.dxf),t=d(s,i);return t}throw new Error("need dxf file")}function o(e){var t=e.split(/\r\n|\r|\n/g),r={},n=t.indexOf("HEADER"),a=t.indexOf("ENDSEC",n)+1,o=t.slice(n,a);r.header=s(o);var i=t.indexOf("TABLES"),c=t.indexOf("ENDSEC",i)+1,p=t.slice(i,c);r.tables=l(p);var f=t.indexOf("BLOCKS"),v=t.indexOf("ENDSEC",f)+1,h=t.slice(f,v);r.blocks=u(h);var m=t.indexOf("ENTITIES"),g=t.indexOf("ENDSEC",m)+1,d=t.slice(m,g);return r.entities=y(d),r}function i(e,t,n,a,o){var i={};return i.x=v(n,e[t]),i.y=v(a,e[t+2]),o!==r&&(i.z=v(o,e[t+4])),i}function s(e){for(var t=e.length,r=0,n={};t>r;){var a=e[r].trim();if("9"===a){var o=e[r+1],s=e[r+2].trim();if("10"===s){var c={},l=r+3;"30"===e[r+6].trim()?(c=i(e,l,10,20,30),r+=8):(c=i(e,l,10,20),r+=6),n[o]=c}else n[o]=v(parseInt(s),e[r+3]),r+=4}else r++}return n}function c(e,t){for(var r,n,a,o=e.length-2,s={};o>t;){switch(r=e[t].trim(),n=e[t+1].trim(),r){case"0":var l=t+2,p=e.indexOf(a,l)+1||o,u=e.slice(l,p-2);s[n]=s[n]||[],s[n].push(c(u,0)),t=p-4;break;case"2":a=n,s.name=n;break;case"3":s.description=n;break;case"5":s.handle=n;break;case"10":case"11":case"12":case"13":case"14":case"15":var l=t+1,f=parseInt(r);s[b[r]]=i(e,l,f,f+10);break;case"16":case"17":var l=t+1,f=parseInt(r);s[b[r]]=i(e,l,f,f+10,f+20);break;case"40":s.patternLength=parseFloat(n);break;case"49":s.elements.push(parseFloat(n));break;case"62":s.color=parseInt(n);break;case"73":s.elements=[];break;case"330":case"360":s.ownerHandle=n}t+=2}return s}function l(e){for(var t=e.length,r=0,n={};t>r;){var a=e.indexOf("TABLE",r),o=e.indexOf("ENDTAB",a)+1;if(0!==o){var i=e.slice(a,o);n[e[a+2]]=c(i,1),r=o}else r=t+1}return n}function p(e,t){for(var r,n,a=e.length-2,o={};a>t;){switch(r=e[t].trim(),n=e[t+1].trim(),r){case"0":var s=e.indexOf("  0",t+2)+1||a,c=e.slice(t,s-1);o.entities=o.entities||[],o.entities.push(f(c,0)),t=s-3;break;case"1":o.xrefName=n;break;case"2":o.name=n;break;case"3":o.blockName=n;break;case"5":o.handle=n;break;case"8":o.layerName=n;break;case"10":var l=t+1;o.basePoint=i(e,l,10,20,30);break;case"330":o.ownerHandle=n;break;case"360":table.ownerHandle=n}t+=2}return o}function u(e){for(var t=e.length,r=0,n={};t>r;){var a=e.indexOf("BLOCK",r),o=e.indexOf("ENDBLK",a)+1;if(0!==o){var i=e.slice(a,o);block=p(i,1),n[block.blockName]=block,r=o}else r=t+1}return n}function f(e,t){for(var n,a,o,s=e.length,c={},l=!1;s>t;){switch(n=e[t].trim(),a=e[t+1].trim(),n){case"0":o=a,c.entityType=a;break;case"1":case"5":case"6":case"7":case"8":c[b[n]]=a;break;case"10":var p=t+1;switch(o){case"HATCH":if(l){var u=c.multiVertices[c.multiVertices.length-1];if(c.verticesNumber>u.length){var f=i(e,p,10,20),y=u[u.length-1];(y===r||y.x!==f.x&&y.y!==f.y)&&u.push(f)}}break;case"LWPOLYLINE":c.vertices=c.vertices||[],c.vertices.push(i(e,p,10,20));break;case"POINT":case"MTEXT":case"XLINE":c.point=i(e,p,10,20,30);break;case"TEXT":case"LINE":c.startPoint=i(e,p,10,20,30)}break;case"11":var p=t+1;switch(o){case"HATCH":if(l){var u=c.multiVertices[c.multiVertices.length-1];u.push(i(e,p,11,21))}l=!1;break;case"TEXT":case"LINE":c.endPoint=i(e,p,10,20,30)}break;case"39":case"48":case"50":case"51":c[b[n]]=parseFloat(a);break;case"40":switch(o){case"TEXT":c.textHeight=parseFloat(a);break;case"ARC":case"CIRCLE":c.radius=parseFloat(a)}break;case"60":case"62":case"70":c[b[n]]=parseInt(a);break;case"72":"1"!==a&&"0"!==a||(l=!0);break;case"91":c.multiVertices=[];break;case"93":c.verticesNumber=parseInt(a),c.multiVertices.push([]);break;case"330":c.ownerHandle=a}t+=2}return c}function y(e){for(var t=e.length,r=0,n=[];t>r;){var a=e.indexOf("  0",r),o=e.indexOf("  0",a+1);if(-1!==o){var i=e.slice(a,o);entity=f(i,0),n.push(entity),r=o}else r=t+1}return n}function v(e,t){return 9>=e?t:e>=10&&59>=e?parseFloat(t):e>=60&&99>=e?parseInt(t):e>=100&&109>=e?t:e>=110&&149>=e?parseFloat(t):e>=160&&179>=e?parseInt(t):e>=210&&239>=e?parseFloat(t):e>=270&&289>=e?parseInt(t):e>=290&&299>=e?!!parseInt(t):e>=300&&369>=e?t:e>=370&&389>=e?parseInt(t):e>=390&&399>=e?t:e>=400&&409>=e?parseInt(t):e>=410&&419>=e?t:e>=420&&429>=e?parseInt(t):e>=430&&439>=e?t:e>=440&&459>=e?parseInt(t):e>=460&&469>=e?parseFloat(t):e>=470&&481>=e?t:999===e?t:e>=1e3&&1009>=e?t:e>=1010&&1059>=e?parseFloat(t):e>=1060&&1071>=e?parseInt(t):t}function h(e,t){var e=t?t.trans([e.x,e.y]):[e.x,e.y];return e}function m(e,t){var n=[];if(e===r);return e.forEach(function(e){n.push(h(e,t))}),n}function g(e,t){var n={};switch(e.entityType){case"ARC":break;case"CIRCLE":break;case"INSERT":break;case"TEXT":n.type="Point",n.coordinates=h(e.startPoint,t);break;case"LINE":n.type="LineString",n.coordinates=m([e.startPoint,e.endPoint],t);break;case"LWPOLYLINE":n.type="LineString",n.coordinates=m(e.vertices,t),1===e.closed&&n.coordinates.push(n.coordinates[0]);break;case"HATCH":n.type="Polygon",n.coordinates=[],e.multiVertices.forEach(function(e){var r=m(e,t);r.push(r[0]),n.coordinates.push(r)})}if(n.type!==r){var a={};return a.type="Feature",a.geometry=n,a.properties={},a.style={},["text","textHeight","textStyleName","layerName","entityType"].forEach(function(t){e[t]!==r&&(a.properties[t]=e[t])}),a}}function d(e,t){console.log(e);var n=GeoConvert.emptyGeojson();for(var a in e.blocks){var o=e.blocks[a],i=o.entities;i!==r&&i.forEach(function(e){var a=g(e,t);a!==r&&n.features.push(a)})}return e.entities.forEach(function(e){var a=g(e,t);a!==r&&n.features.push(a)}),n}var b={1:"text",2:"name",5:"handle",6:"linetypeName",7:"textStyleName",8:"layerName",10:"lowerLeftCorner",11:"upperRightCorner",12:"centerDcs",13:"snapBasePoint",14:"snapSpacing",15:"gridSpacing",16:"viewDirectionFromTarget",17:"viewTarget",39:"thickness",48:"linetypeScale",50:"textRotation",51:"textOblique",60:"visibility",62:"colorNumber",70:"closed"};GeoConvert.dxf2Geojson=function(e,t){var r=a(e);if(t){var n=JSON.stringify(r);return n}return r},n.prototype.trans=function(e){return proj4(this.fromProjection,this.toProjection,e)}}(window,document);